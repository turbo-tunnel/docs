(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{455:function(t,s,n){"use strict";n.r(s);var a=n(24),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"插件支持"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件支持"}},[t._v("#")]),t._v(" 插件支持")]),t._v(" "),n("h2",{attrs:{id:"插件是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件是什么"}},[t._v("#")]),t._v(" 插件是什么")]),t._v(" "),n("p",[t._v("turbo-tunnel插件主要用于对turbo-tunnel能力的扩展，例如：支持更多的第三方/自定义隧道协议；提供流量分析、流量劫持等功能。")]),t._v(" "),n("h2",{attrs:{id:"如何使用插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何使用插件"}},[t._v("#")]),t._v(" 如何使用插件")]),t._v(" "),n("p",[t._v("turbo-tunnel插件本质上就是一个python库，在turbo-tunnel命令行中可以使用"),n("code",[t._v("-p/--plugin")]),t._v("参数加载指定的插件包名。")]),t._v(" "),n("p",[t._v("例如，对于内置插件"),n("code",[t._v("terminal")]),t._v("，可以使用以下命令加载：")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ turbo-tunnel -l http://127.0.0.1:8888/ -p terminal\n")])])]),n("h2",{attrs:{id:"如何实现插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何实现插件"}},[t._v("#")]),t._v(" 如何实现插件")]),t._v(" "),n("p",[t._v("由于turbo-tunnel是基于"),n("code",[t._v("asyncio")]),t._v("、"),n("code",[t._v("tornado")]),t._v("等库开发，因此，插件也必须使用"),n("code",[t._v("asyncio")]),t._v("，以保证整体的兼容。")]),t._v(" "),n("h3",{attrs:{id:"支持第三方隧道-自定义隧道"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持第三方隧道-自定义隧道"}},[t._v("#")]),t._v(" 支持第三方隧道/自定义隧道")]),t._v(" "),n("p",[t._v("1、 实现"),n("code",[t._v("隧道客户端")]),t._v("（继承自"),n("code",[t._v("turbo_tunnel.tunnel.Tunnel")]),t._v("或其子类），并且将其注册到turbo-tunnel中。下面以SSH隧道为例：")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("turbo_tunnel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tunnel_registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ssh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SSHTunnel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("在代码顶层执行以上代码，即可注册SSH隧道。这里的"),n("code",[t._v("ssh")]),t._v("表示使用的协议，不同的隧道类型应当使用不同的协议。")]),t._v(" "),n("blockquote",[n("p",[t._v("这里需要在代码顶层执行以上代码，是为了在加载插件时自动注册，否则会导致无法使用指定的隧道。")])]),t._v(" "),n("p",[t._v("2、 实现"),n("code",[t._v("隧道服务端")])]),t._v(" "),n("p",[t._v("隧道服务端不是必需的，因为有些隧道服务已经有很好的实现了，例如"),n("code",[t._v("SSH Server")]),t._v("。对于这种情况，可以不提供隧道服务端。")]),t._v(" "),n("p",[t._v("对于自定义隧道，就需要自己实现隧道服务端了，它一般是继承自"),n("code",[t._v("turbo_tunnel.server.TunnelServer")]),t._v("，并且实现了"),n("code",[t._v("start")]),t._v("方法，用于开启服务。在接收到请求后，会根据指定的路由或策略配置动态选择路由，并进行请求的转发。")]),t._v(" "),n("h3",{attrs:{id:"提供流量分析、处理能力"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#提供流量分析、处理能力"}},[t._v("#")]),t._v(" 提供流量分析、处理能力")]),t._v(" "),n("p",[t._v("插件定义了如下一些回调接口，在特定事件发生时通知到插件：")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Plugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_load")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_unload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_tunnel_selected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tunnel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_new_connection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_tunnel_address_updated")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tunnel_address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_data_recevied")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_data_sent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on_connection_closed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n")])])]),n("p",[t._v("插件可以基于这些接口执行一些操作，例如抓包、分析流量等工作；目前尚不支持修改数据包，等后面支持了，就可以执行流量修改等操作了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);